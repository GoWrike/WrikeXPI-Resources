<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPI Portal for Master Data</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Font 'Inter' -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        /* Use Inter font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }

        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F2937; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4B5563; /* bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6B7280; /* bg-gray-500 */
        }

        /* Modal styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        
        /* Loader styles */
        .loader {
            border: 4px solid #4B5563; /* bg-gray-600 */
            border-top: 4px solid #3B82F6; /* blue-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast notification styles */
        #toast {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s linear;
        }
    </style>
</head>
<body class="text-gray-100">

    <!-- Header -->
    <header class="bg-gray-800 shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <!-- Simple Logo/Icon -->
                    <svg class="h-8 w-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 12l4.179 2.25m0 0l5.571 3 5.571-3m0 0l4.179-2.25L12 9.75l-4.179 2.25z" />
                    </svg>
                    <span class="ml-3 text-2xl font-bold text-white">XPI Portal</span>
                    <span class="ml-2 text-2xl font-light text-gray-300">| Master Data</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Auth & Control Panel -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-white">API Configuration</h2>
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-grow">
                    <label for="token-input" class="block text-sm font-medium text-gray-300 mb-1">Bearer Token</label>
                    <input type="password" id="token-input" placeholder="Enter your Bearer Token" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="flex-shrink-0 flex gap-4 sm:self-end">
                    <button id="load-data-button" class="w-full sm:w-auto px-5 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 transition duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201-4.752L.938 10.31a.75.75 0 001.06 1.061l3.59-3.592A5.5 5.5 0 0115.312 11.424zM18.3 5.232a.75.75 0 00-1.06-1.06l-3.59 3.592a5.5 5.5 0 00-9.201 4.752l5.17-3.64v-.002l-5.17 3.64a.75.75 0 001.06 1.06l11.66-8.224z" clip-rule="evenodd" />
                        </svg>
                        Load Data
                    </button>
                    <button id="create-button" class="w-full sm:w-auto px-5 py-2 bg-green-600 text-white font-semibold rounded-md shadow-md hover:bg-green-700 transition duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                        </svg>
                        Create New
                    </button>
                </div>
            </div>
        </div>

        <!-- Feedback Area -->
        <div id="feedback-area" class="text-center my-6">
            <div id="loader" class="loader mx-auto hidden"></div>
            <div id="error-message" class="text-red-400 font-medium hidden"></div>
        </div>

        <!-- Data Table -->
        <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full min-w-max">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">Value</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">Note</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">FinCode</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">Code</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">GUID</th>
                            <th class="px-6 py-3 text-center text-xs font-bold text-gray-300 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-gray-800 divide-y divide-gray-700">
                        <!-- Data rows will be injected here -->
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center text-gray-400">
                                No data loaded. Please enter your Bearer Token and click "Load Data".
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Create/Edit Modal -->
    <div id="form-modal" class="modal-overlay fixed inset-0 w-full h-full bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-40 hidden">
        <div class="modal-content bg-gray-800 shadow-2xl rounded-lg w-full max-w-lg mx-4 transform scale-95">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-5 border-b border-gray-700">
                <h3 id="modal-title" class="text-xl font-semibold text-white">Modal Title</h3>
                <button id="close-modal-button" class="text-gray-400 hover:text-white transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="record-form" class="p-6">
                <input type="hidden" id="form-id">
                <div class="space-y-4">
                    <div>
                        <label for="form-value" class="block text-sm font-medium text-gray-300 mb-1">Value</label>
                        <input type="text" id="form-value" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="form-guid" class="block text-sm font-medium text-gray-300 mb-1">GUID</label>
                        <input type="text" id="form-guid" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="form-code" class="block text-sm font-medium text-gray-300 mb-1">Code</label>
                        <input type="text" id="form-code" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="form-fincode" class="block text-sm font-medium text-gray-300 mb-1">FinCode</label>
                        <input type="text" id="form-fincode" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex items-center justify-end pt-6 mt-6 border-t border-gray-700 space-x-3">
                    <button id="cancel-button" type="button" class="px-5 py-2 bg-gray-600 text-white font-semibold rounded-md shadow-md hover:bg-gray-700 transition duration-200">
                        Cancel
                    </button>
                    <button id="save-button" type="submit" class="px-5 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 transition duration-200">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay fixed inset-0 w-full h-full bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-40 hidden">
        <div class="modal-content bg-gray-800 shadow-2xl rounded-lg w-full max-w-md mx-4 transform scale-95">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-5 border-b border-gray-700">
                <h3 class="text-xl font-semibold text-red-400">Confirm Deletion</h3>
                <button id="close-delete-modal-button" class="text-gray-400 hover:text-white transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6">
                <p class="text-gray-300">Are you sure you want to delete this record?</p>
                <p id="delete-record-info" class="font-semibold text-white my-2"></p>
                <p class="text-sm text-red-400">This action cannot be undone.</p>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex items-center justify-end p-5 border-t border-gray-700 space-x-3">
                <button id="delete-cancel-button" type="button" class="px-5 py-2 bg-gray-600 text-white font-semibold rounded-md shadow-md hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="delete-confirm-button" type="button" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-md shadow-md hover:bg-red-700 transition duration-200">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 z-50">
        <div id="toast-content" class="flex items-center w-full max-w-xs p-4 rounded-lg shadow-lg text-gray-100">
            <!-- Content will be set by JS -->
        </div>
    </div>


    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Globals ---
            const API_URL = 'https://xpi-api.gowrike.space/api/v1/wrikexpi/v1.0/record/demoxpiclients';
            const ODATA_CONTEXT = 'https://api.wrikexpi.groupm.com/api/v1/v1.0/demoxpiclients';
            // Default token from your example. WARN: This is likely expired or sensitive.
            const DEFAULT_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0aWQiOiIyNGE3N2Q3Yy1jNzdiLTRmZDktOGI0Zi00ZWZkNmM1YjM3NWYiLCJlbmMiOiJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKa1pXc2lPaUp5UTJ0VlptMW1TMUZ5VldKSE55OVlTako1TlZKRlNDOTJjMUJyZG5oMFVVcHdWR2hFWWtweUwwRnJQU0lzSW1saGRDSTZNVGMyTVRneU9UZzVOaXdpWlhod0lqb3hOell4T1RFMk1qazJmUS5SZGU2dzlOMXIyS0dnRjZuWjlzSHBUOWJwdWpGb29PcFF1TTVPaXhxZFpBIiwiaWF0IjoxNzYxODI5ODk2LCJleHAiOjE3NjE5MTYyOTZ9.jiwoWMErKXf8P8AnKXHIDFa_hYhbQ7UhYP5vf6RvilM';
            let bearerToken = '';

            // --- DOM Elements ---
            const tokenInput = document.getElementById('token-input');
            const loadDataButton = document.getElementById('load-data-button');
            const createButton = document.getElementById('create-button');
            const tableBody = document.getElementById('data-table-body');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('error-message');
            
            // Modals
            const formModal = document.getElementById('form-modal');
            const modalTitle = document.getElementById('modal-title');
            const closeModalButton = document.getElementById('close-modal-button');
            const cancelButton = document.getElementById('cancel-button');
            const recordForm = document.getElementById('record-form');
            const saveButton = document.getElementById('save-button');
            
            const deleteModal = document.getElementById('delete-modal');
            const closeDeleteModalButton = document.getElementById('close-delete-modal-button');
            const deleteCancelButton = document.getElementById('delete-cancel-button');
            const deleteConfirmButton = document.getElementById('delete-confirm-button');
            const deleteRecordInfo = document.getElementById('delete-record-info');
            
            // Toast
            const toast = document.getElementById('toast');
            const toastContent = document.getElementById('toast-content');

            // --- Initial Setup ---
            tokenInput.value = DEFAULT_TOKEN;

            // --- Utility Functions ---

            /**
             * Shows or hides the main loader
             * @param {boolean} isLoading - Whether to show the loader
             */
            function showLoader(isLoading) {
                if (isLoading) {
                    loader.classList.remove('hidden');
                    errorMessage.classList.add('hidden');
                } else {
                    loader.classList.add('hidden');
                }
            }

            /**
             * Shows a main error message
             * @param {string} message - The error message to display
             */
            function showError(message) {
                errorMessage.textContent = `Error: ${message}`;
                errorMessage.classList.remove('hidden');
            }

            /**
             * Shows a toast notification
             * @param {string} message - The message to display
             * @param {boolean} [isError=false] - True for error style, false for success
             */
            function showToast(message, isError = false) {
                toastContent.innerHTML = ''; // Clear previous content
                
                let iconSvg;
                if (isError) {
                    toastContent.className = 'flex items-center w-full max-w-xs p-4 rounded-lg shadow-lg text-gray-100 bg-red-600';
                    iconSvg = `
                        <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-red-100 bg-red-800 rounded-lg">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                            </svg>
                        </div>`;
                } else {
                    toastContent.className = 'flex items-center w-full max-w-xs p-4 rounded-lg shadow-lg text-gray-100 bg-green-600';
                    iconSvg = `
                        <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-green-100 bg-green-800 rounded-lg">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" />
                            </svg>
                        </div>`;
                }
                
                toastContent.innerHTML = `
                    ${iconSvg}
                    <div class="ml-3 text-sm font-normal">${message}</div>
                `;
                
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            /**
             * Renders the data into the table
             * @param {Array} records - An array of record objects
             */
            function renderTable(records) {
                tableBody.innerHTML = ''; // Clear existing data
                if (!records || records.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center text-gray-400">
                                No records found.
                            </td>
                        </tr>`;
                    return;
                }

                records.forEach(record => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-700 transition duration-150';
                    
                    // Helper to safely display null/undefined values
                    const val = (text) => text || '<span class="text-gray-500">N/A</span>';
                    
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${val(record.id)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${val(record.value)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${val(record.note)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${val(record.fincode)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${val(record.code)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${val(record.guid)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                            <button class="edit-btn text-blue-400 hover:text-blue-300" 
                                    data-id="${record.id}" 
                                    data-value="${record.value || ''}"
                                    data-guid="${record.guid || ''}"
                                    data-code="${record.code || ''}"
                                    data-fincode="${record.fincode || ''}">
                                Edit
                            </button>
                            <button class="delete-btn text-red-400 hover:text-red-300"
                                    data-id="${record.id}"
                                    data-value="${record.value || ''}">
                                Delete
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });

                // Add event listeners to new buttons
                document.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', openEditModal));
                document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', openDeleteModal));
            }


            // --- API Functions ---

            /**
             * Fetches all records from the API
             */
            async function fetchData() {
                bearerToken = tokenInput.value;
                if (!bearerToken) {
                    showError('Bearer Token is required.');
                    return;
                }
                
                showLoader(true);
                tableBody.innerHTML = '';
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${bearerToken}`
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    renderTable(data.value);
                } catch (error) {
                    console.error('Fetch error:', error);
                    showError(error.message);
                } finally {
                    showLoader(false);
                }
            }

            /**
             * Handles form submission for Create or Update
             * @param {Event} e - The form submit event
             */
            async function handleFormSubmit(e) {
                e.preventDefault();
                saveButton.disabled = true;
                saveButton.textContent = 'Saving...';
                
                const id = document.getElementById('form-id').value;
                const isUpdate = !!id;

                const payload = {
                    "@odata.context": ODATA_CONTEXT,
                    "value": document.getElementById('form-value').value,
                    "guid": document.getElementById('form-guid').value,
                    "code": document.getElementById('form-code').value,
                    "fincode": document.getElementById('form-fincode').value
                };

                if (isUpdate) {
                    payload.id = id;
                }

                try {
                    const method = isUpdate ? 'PATCH' : 'POST';
                    
                    // Use PATCH for update, POST for create
                    const response = await fetch(API_URL, {
                        method: method, 
                        headers: {
                            'Authorization': `Bearer ${bearerToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }
                    
                    showToast(isUpdate ? 'Record updated successfully!' : 'Record created successfully!');
                    closeFormModal();
                    fetchData(); // Refresh table
                    
                } catch (error) {
                    console.error('Save error:', error);
                    showToast(error.message, true);
                } finally {
                    saveButton.disabled = false;
                    saveButton.textContent = 'Save Changes';
                }
            }

            /**
             * Deletes a record by its ID
             */
            async function handleDelete() {
                const id = deleteConfirmButton.dataset.id;
                if (!id) return;

                deleteConfirmButton.disabled = true;
                deleteConfirmButton.textContent = 'Deleting...';

                // Standard REST assumption: DELETE to /collection/{id}
                const DELETE_URL = `${API_URL}/${id}`; 
                
                try {
                    const response = await fetch(DELETE_URL, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${bearerToken}`
                        }
                    });

                    if (!response.ok) {
                         // Check if response is JSON, otherwise use status text
                        let errorMsg = `HTTP error! status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.message || errorMsg;
                        } catch (e) {
                            // Not JSON, stick with status text
                        }
                        throw new Error(errorMsg);
                    }

                    showToast('Record deleted successfully!');
                    closeDeleteModal();
                    fetchData(); // Refresh table

                } catch (error) {
                    console.error('Delete error:', error);
                    showToast(error.message, true);
                } finally {
                    deleteConfirmButton.disabled = false;
                    deleteConfirmButton.textContent = 'Delete';
                }
            }
            
            // --- Modal Functions ---

            function showModal(modal) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modal.querySelector('.modal-content').classList.remove('scale-95');
                }, 10);
            }

            function hideModal(modal) {
                modal.classList.add('opacity-0');
                modal.querySelector('.modal-content').classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            function openCreateModal() {
                recordForm.reset();
                document.getElementById('form-id').value = '';
                modalTitle.textContent = 'Create New Record';
                formModal.classList.remove('hidden');
                // Animate in
                setTimeout(() => {
                    formModal.querySelector('.modal-content').classList.add('transform', 'scale-100');
                    formModal.classList.add('opacity-100');
                }, 10);
            }

            function openEditModal(e) {
                recordForm.reset();
                const btn = e.currentTarget;
                const dataset = btn.dataset;
                
                document.getElementById('form-id').value = dataset.id;
                document.getElementById('form-value').value = dataset.value;
                document.getElementById('form-guid').value = dataset.guid;
                document.getElementById('form-code').value = dataset.code;
                document.getElementById('form-fincode').value = dataset.fincode;

                modalTitle.textContent = `Edit Record (ID: ${dataset.id})`;
                formModal.classList.remove('hidden');
                // Animate in
                setTimeout(() => {
                    formModal.querySelector('.modal-content').classList.add('transform', 'scale-100');
                    formModal.classList.add('opacity-100');
                }, 10);
            }
            
            function closeFormModal() {
                 // Animate out
                formModal.querySelector('.modal-content').classList.remove('scale-100');
                formModal.classList.remove('opacity-100');
                setTimeout(() => {
                    formModal.classList.add('hidden');
                }, 300);
            }

            function openDeleteModal(e) {
                const btn = e.currentTarget;
                const { id, value } = btn.dataset;
                deleteConfirmButton.dataset.id = id;
                deleteRecordInfo.textContent = `ID: ${id} (${value})`;
                deleteModal.classList.remove('hidden');
                // Animate in
                setTimeout(() => {
                    deleteModal.querySelector('.modal-content').classList.add('transform', 'scale-100');
                    deleteModal.classList.add('opacity-100');
                }, 10);
            }

            function closeDeleteModal() {
                // Animate out
                deleteModal.querySelector('.modal-content').classList.remove('scale-100');
                deleteModal.classList.remove('opacity-100');
                setTimeout(() => {
                    deleteModal.classList.add('hidden');
                }, 300);
            }

            // --- Event Listeners ---
            loadDataButton.addEventListener('click', fetchData);
            createButton.addEventListener('click', openCreateModal);
            recordForm.addEventListener('submit', handleFormSubmit);

            // Modal close buttons
            closeModalButton.addEventListener('click', closeFormModal);
            cancelButton.addEventListener('click', closeFormModal);
            closeDeleteModalButton.addEventListener('click', closeDeleteModal);
            deleteCancelButton.addEventListener('click', closeDeleteModal);
            
            // Delete confirm
            deleteConfirmButton.addEventListener('click', handleDelete);

            // Close modal on overlay click
            formModal.addEventListener('click', (e) => {
                if (e.target === formModal) {
                    closeFormModal();
                }
            });
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) {
                    closeDeleteModal();
                }
            });

        });
    </script>
</body>
</html>

