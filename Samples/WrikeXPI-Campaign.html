<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPI Portal</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 2. Configure Tailwind for Inter font and dark mode */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        html {
            /* Enable dark mode */
            color-scheme: dark;
        }

        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom styles for spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6; /* blue-500 */
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <!-- Main App Container -->
    <div id="app" class="flex h-screen overflow-hidden">

        <!-- Sidebar (Module Navigation) -->
        <nav id="sidebar" class="bg-gray-800 w-64 p-5 flex-col flex-shrink-0 hidden md:flex shadow-lg">
            <!-- App Title -->
            <div class="flex items-center space-x-2 mb-8">
                <svg class="w-8 h-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.83-5.83M11.42 15.17l-4.24-4.24m4.24 4.24L21 12M11.42 15.17l-5.83 5.83A2.652 2.652 0 012.75 21l5.83-5.83M12.75 8.43l-4.24 4.24M12.75 8.43L21 12m-8.25-3.57l-4.24-4.24A2.652 2.652 0 012.75 3l5.83 5.83m5.83 5.83l5.83 5.83m-5.83-5.83l4.24 4.24m-4.24-4.24l-5.83-5.83m5.83 5.83l-4.24 4.24" />
                </svg>
                <h1 class="text-xl font-bold text-white">XPI Portal</h1>
            </div>

            <!-- Module List -->
            <ul class="space-y-2">
                <!-- User-defined Modules -->
                <li>
                    <a href="#campaign" data-module="campaign" class="module-link flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375m0 0l3.004 3.004m-3.004-3.004v1.5m-1.125 6h.008v.008h-.008V9.75m.75-3h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008z" />
                        </svg>
                        <span>Campaign Submission</span>
                    </a>
                </li>
                <!-- Built-in Modules -->
                <li>
                    <a href="#admin" data-module="admin" class="module-link flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93s.844.27 1.25.121l.894-.15c.542-.09.994.196 1.213.662l.546 1.093c.218.467.126 1.006-.196 1.293l-.71.517c-.377.27-.599.69-.62.1.135-.02.268-.006.402l-.168.93c-.09.542-.56.94-1.11.94h-1.093c-.55 0-1.02-.398-1.11-.94l-.149-.894c-.07-.424-.384-.764-.78-.93s-.844-.27-1.25-.121l-.894.15c-.542.09-.994-.196-1.213-.662l-.546-1.093c-.218-.467-.126-1.006.196-1.293l.71-.517c.377-.27.599-.69.62-.1.135.02.268.006.402l.168-.93z" />
                           <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span>Admin</span>
                    </a>
                </li>
            </ul>

            <!-- Profile Section -->
            <div id="profile-section" class="mt-auto pt-4 border-t border-gray-700 hidden">
                <div class="flex items-center space-x-3">
                    <img id="profile-avatar" src="" alt="User Avatar" class="w-10 h-10 rounded-full bg-gray-600 object-cover">
                    <div>
                        <p id="profile-name" class="font-semibold text-sm text-white">Loading...</p>
                        <a href="#" id="logout-button" class="text-xs text-blue-400 hover:underline">Logout</a>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Mobile Sidebar (identical structure, but hidden/shown) -->
        <div id="mobile-sidebar" class="fixed inset-0 bg-gray-900 bg-opacity-90 z-40 p-5 flex-col flex-shrink-0 flex md:hidden transition-transform duration-300 ease-in-out -translate-x-full">
            <!-- Close Button -->
            <button id="close-sidebar-button" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <!-- App Title -->
            <div class="flex items-center space-x-2 mb-8">
                <svg class="w-8 h-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.83-5.83M11.42 15.17l-4.24-4.24m4.24 4.24L21 12M11.42 15.17l-5.83 5.83A2.652 2.652 0 012.75 21l5.83-5.83M12.75 8.43l-4.24 4.24M12.75 8.43L21 12m-8.25-3.57l-4.24-4.24A2.652 2.652 0 012.75 3l5.83 5.83m5.83 5.83l5.83 5.83m-5.83-5.83l4.24 4.24m-4.24-4.24l-5.83-5.83m5.83 5.83l-4.24 4.24" /></svg>
                <h1 class="text-xl font-bold text-white">XPI Portal</h1>
            </div>
            <!-- Module List -->
            <ul class="space-y-2">
                <li><a href="#campaign" data-module="campaign" class="module-link flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375m0 0l3.004 3.004m-3.004-3.004v1.5m-1.125 6h.008v.008h-.008V9.75m.75-3h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008zm.375 0h.008v.008h-.008v-.008z" /></svg><span>Campaign Submission</span></a></li>
                <li><a href="#admin" data-module="admin" class="module-link flex items-center space-x-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93s.844.27 1.25.121l.894-.15c.542-.09.994.196 1.213.662l.546 1.093c.218.467.126 1.006-.196 1.293l-.71.517c-.377.27-.599.69-.62.1.135-.02.268-.006.402l-.168.93c-.09.542-.56.94-1.11.94h-1.093c-.55 0-1.02-.398-1.11-.94l-.149-.894c-.07-.424-.384-.764-.78-.93s-.844-.27-1.25-.121l-.894.15c-.542.09-.994-.196-1.213-.662l-.546-1.093c-.218-.467-.126-1.006.196-1.293l.71-.517c.377-.27.599.69.62-.1.135.02.268.006.402l.168-.93z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span>Admin</span></a></li>
            </ul>
            <!-- Mobile Profile -->
            <div id="mobile-profile-section" class="mt-auto pt-4 border-t border-gray-700 hidden">
                <div class="flex items-center space-x-3">
                    <img id="mobile-profile-avatar" src="" alt="User Avatar" class="w-10 h-10 rounded-full bg-gray-600 object-cover">
                    <div>
                        <p id="mobile-profile-name" class="font-semibold text-sm text-white">Loading...</p>
                        <a href="#" id="mobile-logout-button" class="text-xs text-blue-400 hover:underline">Logout</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Mobile Header -->
            <header class="md:hidden bg-gray-800 shadow-md p-4 flex items-center space-x-4">
                <button id="open-sidebar-button" class="text-gray-300 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <h2 id="module-title" class="text-lg font-semibold text-white">XPI Portal</h2>
            </header>

            <!-- Module Content Scroller -->
            <div class="flex-1 overflow-y-auto p-6 md:p-10">

                <!-- ===== Module: Admin (MOD.A) ===== -->
                <div id="module-admin" class="module-content hidden max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-white mb-6">Admin Configuration</h2>
                    <div class="bg-gray-800 p-8 rounded-lg shadow-xl space-y-6">
                        <div>
                            <label for="xpiBaseUrl" class="block text-sm font-medium text-gray-300 mb-2">XPI Base URL</label>
                            <input type="text" id="xpiBaseUrl" name="xpiBaseUrl" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://api.wrikexpi.groupm.com">
                        </div>
                        <div class="flex justify-end">
                            <button id="admin-save-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg transition duration-200">
                                Save
                            </button>
                        </div>
                        <div id="admin-feedback" class="text-sm"></div>
                    </div>
                </div>

                <!-- ===== Module: Login (MOD.B) ===== -->
                <div id="module-login" class="module-content hidden">
                    <div class="max-w-md mx-auto mt-10 text-center">
                        <!-- Mode 1: Authentication -->
                        <div id="login-auth-mode">
                            <h2 class="text-3xl font-bold text-white mb-4">Welcome to XPI Portal</h2>
                            <p class="text-gray-400 mb-8">Please login to continue.</p>
                            <button id="login-auth-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-lg">
                                Login & Authenticate with Wrike
                            </button>
                        </div>
                        
                        <!-- Mode 2: Callback -->
                        <div id="login-callback-mode" class="hidden">
                            <div class="flex justify-center mb-4">
                                <div class="spinner"></div>
                            </div>
                            <p class="text-lg text-gray-300 mb-4">Authenticating... Please wait.</p>
                            
                            <div id="login-feedback-message" class="text-left"></div>

                            <pre id="login-error-details" class="hidden bg-gray-800 text-red-300 p-4 rounded-lg text-left text-xs overflow-x-auto my-4"></pre>
                            
                            <button id="login-start-over-button" class="hidden mt-6 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                                Start Over
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ===== Module: Campaign Submission (MOD.C) ===== -->
                <div id="module-campaign" class="module-content hidden">
                    <h2 class="text-3xl font-bold text-white mb-6">New Campaign Submission</h2>
                    
                    <!-- Form Loading Spinner -->
                    <div id="campaign-loader" class="hidden text-center p-10">
                        <div class="flex justify-center mb-4">
                            <div class="spinner"></div>
                        </div>
                        <p class="text-lg text-gray-300">Loading form data...</p>
                    </div>

                    <!-- Form Error -->
                    <div id="campaign-form-error" class="hidden bg-red-800 border border-red-700 text-red-200 px-4 py-3 rounded-lg mb-6">
                        <p class="font-bold">Error loading form data!</p>
                        <p class="text-sm">Could not fetch required dropdown values. Please check your connection or credentials and <a href="#campaign" class="font-bold underline" onclick="window.location.reload()">refresh</a>.</p>
                    </div>

                    <!-- Form -->
                    <form id="campaign-form" class="hidden max-w-4xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl space-y-6">
                        <!-- Hidden Fields -->
                        <input type="hidden" name="type" value="Campaign Request">
                        <input type="hidden" name="space" value="GRM-MYS-GMN">
                        <input type="hidden" name="entity" value="Campaign">
                        <input type="hidden" name="varientId" value="1">
                        
                        <!-- Responsive Grid for Form Fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <!-- Campaign Name -->
                            <div>
                                <label for="campaignname" class="block text-sm font-medium text-gray-300 mb-2">Campaign Name</label>
                                <input type="text" id="campaignname" name="fields.campaignname" value="World Pinball Day 7000" required class="form-input">
                            </div>

                            <!-- Client -->
                            <div>
                                <label for="client" class="block text-sm font-medium text-gray-300 mb-2">Client</label>
                                <select id="client" name="fields.client" required class="form-input">
                                    <option value="" disabled selected>Loading...</option>
                                </select>
                            </div>

                            <!-- Debtor -->
                            <div>
                                <label for="debtor" class="block text-sm font-medium text-gray-300 mb-2">Debtor</label>
                                <select id="debtor" name="fields.debtor" required class="form-input">
                                    <option value="" disabled selected>Loading...</option>
                                </select>
                            </div>

                            <!-- Agency -->
                            <div>
                                <label for="agency" class="block text-sm font-medium text-gray-300 mb-2">Agency</label>
                                <select id="agency" name="fields.agency" required class="form-input">
                                    <option value="" disabled selected>Loading...</option>
                                </select>
                            </div>
                            
                            <!-- Brand -->
                            <div>
                                <label for="brand" class="block text-sm font-medium text-gray-300 mb-2">Brand</label>
                                <input type="text" id="brand" name="fields.brand" value="World Pinball" required class="form-input">
                            </div>
                            
                            <!-- Pod -->
                            <div>
                                <label for="pod" class="block text-sm font-medium text-gray-300 mb-2">Pod</label>
                                <input type="text" id="pod" name="fields.pod" value="Pod 1A" required class="form-input">
                            </div>

                            <!-- Requested Start Date -->
                            <div>
                                <label for="requestedstartdate" class="block text-sm font-medium text-gray-300 mb-2">Requested Start Date</label>
                                <input type="date" id="requestedstartdate" name="fields.requestedstartdate" value="2026-07-01" required class="form-input" style="color-scheme: dark;">
                            </div>

                            <!-- Campaign Start Date -->
                            <div>
                                <label for="campaignstartdate" class="block text-sm font-medium text-gray-300 mb-2">Campaign Start Date</label>
                                <input type="date" id="campaignstartdate" name="fields.campaignstartdate" value="2026-08-29" required class="form-input" style="color-scheme: dark;">
                            </div>
                            
                            <!-- Campaign End Date -->
                            <div>
                                <label for="campaignenddate" class="block text-sm font-medium text-gray-300 mb-2">Campaign End Date</label>
                                <input type="date" id="campaignenddate" name="fields.campaignenddate" value="2026-10-29" required class="form-input" style="color-scheme: dark;">
                            </div>

                            <!-- Campaign Objective -->
                            <div>
                                <label for="campaignobjective" class="block text-sm font-medium text-gray-300 mb-2">Campaign Objective</label>
                                <input type="text" id="campaignobjective" name="fields.campaignobjective" value="Upper Funnel / Awareness" required class="form-input">
                            </div>
                            
                            <!-- Requestor Market -->
                            <div>
                                <label for="requestormarket" class="block text-sm font-medium text-gray-300 mb-2">Requestor Market</label>
                                <input type="text" id="requestormarket" name="fields.requestormarket" value="Singapore" required class="form-input">
                            </div>
                            
                            <!-- Overall Budget -->
                            <div>
                                <label for="overallbudget" class="block text-sm font-medium text-gray-300 mb-2">Overall Budget</label>
                                <input type="number" id="overallbudget" name="fields.overallbudget" value="100" required class="form-input">
                            </div>

                            <!-- Currency -->
                            <div>
                                <label for="currency" class="block text-sm font-medium text-gray-300 mb-2">Currency</label>
                                <input type="text" id="currency" name="fields.currency" value="SGD" required class="form-input">
                            </div>

                            <!-- Opt-in -->
                            <div>
                                <label for="optin" class="block text-sm font-medium text-gray-300 mb-2">Opt-in</label>
                                <select id="optin" name="fields.optin" class="form-input">
                                    <option value="No">No</option>
                                    <option value="Yes">Yes</option>
                                </select>
                            </div>
                            
                            <!-- PO Required -->
                            <div>
                                <label for="porequired" class="block text-sm font-medium text-gray-300 mb-2">PO Required</label>
                                <select id="porequired" name="fields.porequired" class="form-input">
                                    <option value="No">No</option>
                                    <option value="Yes">Yes</option>
                                </select>
                            </div>

                            <!-- Selected Channels (col-span-2) -->
                            <div class="md:col-span-2">
                                <label for="selectedchannels" class="block text-sm font-medium text-gray-300 mb-2">Selected Channels</label>
                                <input type="text" id="selectedchannels" name="fields.selectedchannels" value="Twitter" required class="form-input">
                                <p class="text-xs text-gray-400 mt-1">Enter channels separated by a comma (e.g., Twitter, Facebook)</p>
                            </div>

                        </div>

                        <!-- Submission Button -->
                        <div class="flex justify-end pt-4">
                            <button type="submit" id="campaign-submit-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center space-x-2">
                                <span id="campaign-submit-text">Submit Campaign</span>
                                <div id="campaign-submit-spinner" class="hidden spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>
                            </button>
                        </div>
                    </form>

                    <!-- Submission Result -->
                    <div id="campaign-result-container" class="hidden mt-6 max-w-4xl mx-auto">
                        <h3 class="text-lg font-semibold mb-2">Submission Result:</h3>
                        <pre id="campaign-result" class="bg-gray-800 p-4 rounded-lg text-xs overflow-x-auto"></pre>
                    </div>

                </div>

            </div> <!-- End Module Content Scroller -->
        </main> <!-- End Main Content Area -->

    </div> <!-- End App Container -->

    <!-- Developer Tool Toggle -->
    <button id="dev-tool-toggle" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg z-50 transition-transform hover:scale-110">
        <!-- Hat Icon -->
        <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor">
            <path d="M320 32c0-9.9-4.5-19.2-12.3-25.2S289.8-1.4 280.2 1l-176 48c-11.9 3.3-21.1 13.3-24 25.9S82 103.8 92.9 112L160 168.3V320c0 17.7 14.3 32 32 32h160c17.7 0 32-14.3 32-32V168.3l67.1-56.3c10.9-8.2 14.3-22.1 8.3-34.8s-17.8-21-30.2-19.6l-176-48c-8.4-2.3-17.2-1.3-25 2.7s-13.8 9.9-16.5 18.2L288 128l8.3-22.7c2.8-7.7 9.1-13.4 17.2-15.5L472.2 32.9C474.6 32.3 477 32 479.4 32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H448c-17.7 0-32-14.3-32-32h-3.4c-.4 0-.7 0-1.1 .1L304 100.2c-2.3 .6-4.5 1.5-6.6 2.6l-32 16c-4.4 2.2-9.2 3.4-14.1 3.7c-4.9 .3-9.8-.5-14.4-2.2l-32-11.6c-4.6-1.7-9.4-2.7-14.4-3.2c-5-.5-10.1 .1-14.9 1.7L160 112.5V80c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32V87.7l16-5.8c4.6-1.7 9.4-2.7 14.4-3.2c5-.5 10.1 .1 14.9 1.7l32 11.6c4.6 1.7 9.5 2.4 14.4 2.2c4.9-.2 9.7-1.4 14.1-3.7l32-16c2.1-1.1 4.3-2 6.6-2.6l107.5-29.3c.4-.1.7-.1 1.1-.1H352c17.7 0 32 14.3 32 32s-14.3 32-32 32H320zM320 352H224c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32zm0 96H224c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32z"/>
        </svg>
    </button>
    
    <!-- Developer Tool Modal -->
    <div id="dev-tool-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 md:p-8">
        <div class="w-full h-full max-w-6xl max-h-[85vh] bg-gray-800 rounded-lg shadow-xl flex flex-col">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 class="text-xl font-semibold text-white">Developer API Logs</h3>
                <div class="space-x-4">
                    <button id="dev-tool-purge" title="Purge Logs" class="text-gray-400 hover:text-red-400 transition-colors">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.502 0l-1.12.397A48.094 48.094 0 007.5 5.79v7.503a.75.75 0 01-.75.75H4.5a.75.75 0 01-.75-.75V5.79m16.5 0v7.503a.75.75 0 00.75.75h2.25a.75.75 0 00.75-.75V5.79m-1.99.011A48.094 48.094 0 017.5 5.79m-1.12.397a48.094 48.094 0 01-3.478-.397m11.378 0c.342.052.682.107 1.022.166" />
                        </svg>
                    </button>
                    <button id="dev-tool-close" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Log Content -->
            <div class="flex-1 p-4 overflow-y-auto">
                <table class="w-full text-left text-sm">
                    <thead class="sticky top-0 bg-gray-700 text-gray-300 uppercase text-xs">
                        <tr>
                            <th class="p-3">Time</th>
                            <th class="p-3">Status</th>
                            <th class="p-3">Method</th>
                            <th class="p-3">URL</th>
                            <th class="p-3">Details</th>
                        </tr>
                    </thead>
                    <tbody id="dev-log-table-body" class="divide-y divide-gray-700">
                        <!-- Log rows will be injected here -->
                        <tr id="dev-log-empty" class="text-center">
                            <td colspan="5" class="p-4 text-gray-500">No API calls logged yet.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Global JS -->
    <script>
        // === APP STATE AND CONFIG ===
        
        // Global log store
        let apiLogs = [];
        
        // DOM Elements
        const dom = {
            sidebar: document.getElementById('sidebar'),
            mobileSidebar: document.getElementById('mobile-sidebar'),
            openSidebarButton: document.getElementById('open-sidebar-button'),
            closeSidebarButton: document.getElementById('close-sidebar-button'),
            profileSection: document.getElementById('profile-section'),
            profileAvatar: document.getElementById('profile-avatar'),
            profileName: document.getElementById('profile-name'),
            logoutButton: document.getElementById('logout-button'),
            mobileProfileSection: document.getElementById('mobile-profile-section'),
            mobileProfileAvatar: document.getElementById('mobile-profile-avatar'),
            mobileProfileName: document.getElementById('mobile-profile-name'),
            mobileLogoutButton: document.getElementById('mobile-logout-button'),
            moduleTitle: document.getElementById('module-title'),
            devToolToggle: document.getElementById('dev-tool-toggle'),
            devToolModal: document.getElementById('dev-tool-modal'),
            devToolClose: document.getElementById('dev-tool-close'),
            devToolPurge: document.getElementById('dev-tool-purge'),
            devLogTableBody: document.getElementById('dev-log-table-body'),
            devLogEmpty: document.getElementById('dev-log-empty'),
            moduleLinks: document.querySelectorAll('.module-link'),
            allModules: document.querySelectorAll('.module-content'),
            
            // Admin Module
            admin: {
                module: document.getElementById('module-admin'),
                xpiBaseUrlInput: document.getElementById('xpiBaseUrl'),
                saveButton: document.getElementById('admin-save-button'),
                feedback: document.getElementById('admin-feedback'),
            },
            
            // Login Module
            login: {
                module: document.getElementById('module-login'),
                authMode: document.getElementById('login-auth-mode'),
                callbackMode: document.getElementById('login-callback-mode'),
                authButton: document.getElementById('login-auth-button'),
                feedback: document.getElementById('login-feedback-message'),
                errorDetails: document.getElementById('login-error-details'),
                startOverButton: document.getElementById('login-start-over-button'),
            },

            // Campaign Module
            campaign: {
                module: document.getElementById('module-campaign'),
                loader: document.getElementById('campaign-loader'),
                formError: document.getElementById('campaign-form-error'),
                form: document.getElementById('campaign-form'),
                submitButton: document.getElementById('campaign-submit-button'),
                submitText: document.getElementById('campaign-submit-text'),
                submitSpinner: document.getElementById('campaign-submit-spinner'),
                resultContainer: document.getElementById('campaign-result-container'),
                resultPre: document.getElementById('campaign-result'),
            }
        };

        // === STORAGE & CONFIG HELPERS ===
        
        const config = {
            defaultXpiBaseUrl: 'https://api.wrikexpi.groupm.com',
            get: (key, defaultValue = null) => {
                return localStorage.getItem(key) ?? defaultValue;
            },
            set: (key, value) => {
                localStorage.setItem(key, value);
            },
            remove: (key) => {
                localStorage.removeItem(key);
            },
            getXpiBaseUrl: () => {
                return config.get('xpiBaseUrl', config.defaultXpiBaseUrl);
            }
        };

        // === AUTHENTICATION HELPERS ===

        const auth = {
            isLoggedIn: () => {
                return !!(config.get('token') && config.get('username') && config.get('password'));
            },
            getProfile: () => ({
                firstName: config.get('firstName'),
                lastName: config.get('lastName'),
                avatarUrl: config.get('avatarUrl'),
            }),
            getBasicAuth: () => {
                const username = config.get('username');
                const password = config.get('password');
                if (!username || !password) return null;
                return 'Basic ' + btoa(username + ':' + password);
            },
            getBearerToken: () => {
                const token = config.get('token');
                if (!token) return null;
                return 'Bearer ' + token;
            },
            logout: () => {
                config.remove('token');
                config.remove('username');
                config.remove('password');
                config.remove('clientId');
                config.remove('firstName');
                config.remove('lastName');
                config.remove('avatarUrl');
                window.location.href = window.location.pathname; // Redirect to base
            }
        };

        // === UI & ROUTING HELPERS ===
        
        /**
         * Hides all modules.
         */
        function hideAllModules() {
            dom.allModules.forEach(module => module.classList.add('hidden'));
            dom.sidebar.classList.add('hidden');
            dom.sidebar.classList.remove('md:flex');
        }

        /**
         * Shows a specific module by ID and runs its initializer.
         * @param {string} moduleId - The ID of the module (e.g., 'admin', 'login', 'campaign')
         */
        function showModule(moduleId) {
            hideAllModules();
            
            const moduleEl = document.getElementById(`module-${moduleId}`);
            let moduleTitle = 'XPI Portal';

            if (moduleEl) {
                moduleEl.classList.remove('hidden');
                
                // Show sidebar for logged-in modules
                if (moduleId === 'admin' || moduleId === 'campaign') {
                    dom.sidebar.classList.remove('hidden');
                    dom.sidebar.classList.add('md:flex');
                    updateUserProfileDisplay();
                }

                // Set active link in sidebar
                dom.moduleLinks.forEach(link => {
                    if (link.dataset.module === moduleId) {
                        link.classList.add('bg-gray-700', 'text-white');
                        link.classList.remove('text-gray-300');
                        moduleTitle = link.querySelector('span').textContent;
                    } else {
                        link.classList.remove('bg-gray-700', 'text-white');
                        link.classList.add('text-gray-300');
                    }
                });

                // Run module-specific initialization logic
                switch (moduleId) {
                    case 'admin':
                        initAdminModule();
                        break;
                    case 'login':
                        initLoginModule();
                        break;
                    case 'campaign':
                        initCampaignModule();
                        break;
                }
            }
            dom.moduleTitle.textContent = moduleTitle;
        }
        
        /**
         * Updates the profile display in the sidebar.
         */
        function updateUserProfileDisplay() {
            if (auth.isLoggedIn()) {
                const profile = auth.getProfile();
                const fullName = `${profile.firstName || ''} ${profile.lastName || ''}`.trim();
                
                // Desktop Sidebar
                dom.profileName.textContent = fullName || 'User';
                dom.profileAvatar.src = profile.avatarUrl || `https://placehold.co/40x40/4b5563/E0E7FF?text=${(profile.firstName || 'U').charAt(0)}`;
                dom.profileSection.classList.remove('hidden');
                
                // Mobile Sidebar
                dom.mobileProfileName.textContent = fullName || 'User';
                dom.mobileProfileAvatar.src = profile.avatarUrl || `https://placehold.co/40x40/4b5563/E0E7FF?text=${(profile.firstName || 'U').charAt(0)}`;
                dom.mobileProfileSection.classList.remove('hidden');
            } else {
                dom.profileSection.classList.add('hidden');
                dom.mobileProfileSection.classList.add('hidden');
            }
        }

        /**
         * Main routing logic for the application.
         */
        function handleRouting() {
            const hash = window.location.hash.substring(1); // Get hash, remove '#'
            const params = new URLSearchParams(window.location.search);

            if (hash === 'admin') {
                showModule('admin');
            } else if (params.has('code')) {
                showModule('login'); // Login module will handle callback mode
            } else if (auth.isLoggedIn()) {
                // Default to campaign if logged in and no specific hash
                showModule(hash === 'campaign' ? 'campaign' : 'campaign');
            } else {
                showModule('login'); // Default to login if not authenticated
            }
            
            // Close mobile sidebar on navigation
            dom.mobileSidebar.classList.add('-translate-x-full');
        }

        // === DEV TOOL HELPERS ===

        /**
         * Logs an API call to the global store and updates the dev tool.
         * @param {object} request - { method, url, headers, body }
         * @param {object} response - The JSON/text response
         * @param {number} status - The HTTP status code
         */
        function logApiCall(request, response, status) {
            const logEntry = {
                time: new Date(),
                status: status,
                method: request.method,
                url: request.url,
                request: request,
                response: response
            };
            apiLogs.unshift(logEntry); // Add to the beginning (chronological)
            renderDevToolLogs();
        }

        /**
         * Renders the apiLogs array into the dev tool modal table.
         */
        function renderDevToolLogs() {
            if (apiLogs.length === 0) {
                dom.devLogEmpty.classList.remove('hidden');
                dom.devLogTableBody.innerHTML = '';
                dom.devLogTableBody.appendChild(dom.devLogEmpty);
                return;
            }

            dom.devLogEmpty.classList.add('hidden');
            dom.devLogTableBody.innerHTML = ''; // Clear existing logs

            apiLogs.forEach(log => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-700 cursor-pointer';
                
                let statusColor = 'text-gray-400';
                if (log.status >= 200 && log.status < 300) statusColor = 'text-green-400';
                if (log.status >= 400) statusColor = 'text-red-400';
                if (log.status === 0) statusColor = 'text-yellow-400'; // Network Error

                tr.innerHTML = `
                    <td class="p-3 whitespace-nowrap">${log.time.toLocaleTimeString()}</td>
                    <td class="p-3 font-medium ${statusColor}">${log.status}</td>
                    <td class="p-3 whitespace-nowrap">${log.method}</td>
                    <td class="p-3 truncate max-w-xs" title="${log.url}">${log.url}</td>
                    <td class="p-3"><button class="text-blue-400 hover:underline text-xs">View</button></td>
                `;
                
                // Add click listener to show details
                tr.querySelector('button').addEventListener('click', () => {
                    const details = `
REQUEST
==============
${log.method} ${log.url}
Headers:
${JSON.stringify(log.request.headers, null, 2)}

Body:
${log.request.body ? JSON.stringify(JSON.parse(log.request.body), null, 2) : 'N/A'}

RESPONSE (${log.status})
==============
${JSON.stringify(log.response, null, 2)}
                    `;
                    // Using a simple alert for brevity, a modal would be better
                    console.log(details);
                    alert('Log details copied to console.');
                });
                
                dom.devLogTableBody.appendChild(tr);
            });
        }

        function purgeLogs() {
            apiLogs = [];
            renderDevToolLogs();
        }
        
        function toggleDevTool(show) {
            if (show) {
                dom.devToolModal.classList.remove('hidden');
            } else {
                dom.devToolModal.classList.add('hidden');
            }
        }

        // === API CALL WRAPPER ===

        /**
         * A wrapper for fetch that automatically logs to the dev tool.
         * @param {string} url - The URL to fetch
         * @param {object} options - The fetch options (method, headers, body)
         * @returns {Promise<object>} - { ok, status, data }
         */
        async function loggedFetch(url, options = {}) {
            const requestLog = {
                method: options.method || 'GET',
                url: url,
                headers: options.headers || {},
                body: options.body || null
            };
            
            try {
                const response = await fetch(url, options);
                let data;
                try {
                    data = await response.json();
                } catch (e) {
                    data = await response.text();
                }
                
                logApiCall(requestLog, data, response.status);
                
                return { ok: response.ok, status: response.status, data: data };

            } catch (error) {
                console.error('Fetch Error:', error);
                const errorResponse = {
                    error: "Network Error",
                    message: error.message
                };
                logApiCall(requestLog, errorResponse, 0); // 0 for network/CORS error
                return { ok: false, status: 0, data: errorResponse };
            }
        }


        // === MODULE INITIALIZERS ===
        
        // --- A. Admin Module ---
        function initAdminModule() {
            dom.admin.xpiBaseUrlInput.value = config.getXpiBaseUrl();
            dom.admin.feedback.textContent = '';
        }
        
        function saveAdminSettings() {
            const newUrl = dom.admin.xpiBaseUrlInput.value;
            config.set('xpiBaseUrl', newUrl || config.defaultXpiBaseUrl);
            dom.admin.feedback.textContent = 'Settings saved successfully!';
            dom.admin.feedback.className = 'text-green-400 text-sm';
            setTimeout(() => { dom.admin.feedback.textContent = ''; }, 3000);
        }

        // --- B. Login Module ---
        function initLoginModule() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('code')) {
                // Mode 2: Callback
                dom.login.authMode.classList.add('hidden');
                dom.login.callbackMode.classList.remove('hidden');
                handleOAuthCallback(params.get('code'));
            } else {
                // Mode 1: Authentication
                dom.login.authMode.classList.remove('hidden');
                dom.login.callbackMode.classList.add('hidden');
            }
        }
        
        /**
         * (Login Mode 1) Handles the redirect to Wrike OAuth.
         */
        async function handleOAuthRedirect() {
            dom.login.authButton.disabled = true;
            dom.login.authButton.textContent = 'Redirecting...';
            
            try {
                // Generate clientId
                const timestamp = Date.now().toString();
                const random = Math.random().toString();
                const data = new TextEncoder().encode(timestamp + random);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                const clientId = hexHash.slice(-7);
                
                config.set('clientId', clientId);
                
                const baseUrl = config.getXpiBaseUrl();
                const redirectUri = window.location.origin + window.location.pathname;
                const authUrl = `${baseUrl}/?accountId=3128883&redirectUri=${encodeURIComponent(redirectUri)}&client_id=${clientId}`;
                
                // Redirect
                window.location.href = authUrl;

            } catch (error) {
                console.error('SHA-256 Error:', error);
                dom.login.authButton.disabled = false;
                dom.login.authButton.textContent = 'Login & Authenticate with Wrike';
                // Show an error message (not specified in req, but good UX)
                dom.login.feedback.textContent = 'Error preparing authentication. Please try again.';
                dom.login.feedback.className = 'text-red-400 mb-4';
            }
        }
        
        /**
         * (Login Mode 2) Handles the OAuth callback from Wrike.
         * @param {string} code - The authorization code from the URL.
         */
        async function handleOAuthCallback(code) {
            const clientId = config.get('clientId');
            const baseUrl = config.getXpiBaseUrl();
            const basePageUrl = window.location.origin + window.location.pathname;

            // 1. Validation
            if (!code || !clientId) {
                showLoginError(
                    'Authentication Error: Missing code or client ID. Redirecting...',
                    { error: 'Missing required parameters.' }
                );
                setTimeout(() => { window.location.href = basePageUrl; }, 10000);
                return;
            }
            
            // 2. API Call (Token Exchange)
            dom.login.feedback.textContent = 'Exchanging token...';
            const tokenUrl = `${baseUrl}/api/v1/wrikexpi/token/exchange?code=${code}&client_id=${clientId}&grant_type=authorization_code`;
            
            const tokenResponse = await loggedFetch(tokenUrl, { method: 'GET' });

            if (!tokenResponse.ok || !tokenResponse.data.success) {
                showLoginError('Token exchange failed. Please try again.', tokenResponse.data);
                return;
            }
            
            // 3. Store Credentials
            const { token, credentials } = tokenResponse.data.data;
            config.set('token', token);
            config.set('username', credentials.username);
            config.set('password', credentials.password);

            // 4. API Call (Verify Profile)
            dom.login.feedback.textContent = 'Verifying profile...';
            const profileUrl = `${baseUrl}/api/v1/wrikexpi/amoeba/wrikeapi/contacts?me`;
            const profileHeaders = { 'Authorization': auth.getBasicAuth() };
            
            const profileResponse = await loggedFetch(profileUrl, { 
                method: 'GET', 
                headers: profileHeaders 
            });

            if (!profileResponse.ok || !profileResponse.data.success) {
                showLoginError('Login failed: We were unable to verify your account. Please try again.', profileResponse.data);
                return;
            }
            
            // 5. Success
            const profile = profileResponse.data.data[0];
            config.set('firstName', profile.firstName);
            config.set('lastName', profile.lastName);
            config.set('avatarUrl', profile.avatarUrl);
            
            dom.login.feedback.textContent = `${profile.firstName} ${profile.lastName} login successfully. Redirecting...`;
            dom.login.feedback.className = 'text-green-400 text-lg mb-4';
            
            // Redirect to the app (which will now route to 'campaign')
            setTimeout(() => {
                window.location.href = basePageUrl;
            }, 3000);
        }
        
        /**
         * Helper to display errors on the Login module.
         * @param {string} message - The user-friendly message.
         * @param {object} errorData - The API response object to display.
         */
        function showLoginError(message, errorData) {
            dom.login.feedback.textContent = message;
            dom.login.feedback.className = 'text-red-400 text-lg mb-4';
            dom.login.errorDetails.textContent = JSON.stringify(errorData, null, 2);
            dom.login.errorDetails.classList.remove('hidden');
            dom.login.startOverButton.classList.remove('hidden');
        }

        // --- C. Campaign Module ---
        
        /**
         * Initializes the Campaign module, fetching dropdown data.
         */
        async function initCampaignModule() {
            // Show loader, hide form
            dom.campaign.loader.classList.remove('hidden');
            dom.campaign.form.classList.add('hidden');
            dom.campaign.formError.classList.add('hidden');
            
            const baseUrl = config.getXpiBaseUrl();
            const basicAuth = auth.getBasicAuth();
            
            if (!basicAuth) {
                // This shouldn't happen if routing is correct, but good to check
                auth.logout(); 
                return;
            }
            
            const headers = { 'Authorization': basicAuth };
            
            const urls = {
                client: `${baseUrl}/api/v1/wrikexpi/v1.0/value/clients-grm-mys`,
                debtor: `${baseUrl}/api/v1/wrikexpi/v1.0/value/debtors-grm-mys`,
                agency: `${baseUrl}/api/v1/wrikexpi/v1.0/value/agencies`
            };

            try {
                const [clientRes, debtorRes, agencyRes] = await Promise.all([
                    loggedFetch(urls.client, { headers }),
                    loggedFetch(urls.debtor, { headers }),
                    loggedFetch(urls.agency, { headers })
                ]);
                
                // Check if all requests were successful
                if (!clientRes.ok || !debtorRes.ok || !agencyRes.ok) {
                    throw new Error('One or more dropdown API calls failed.');
                }
                
                // Populate dropdowns
                populateSelect('client', clientRes.data.value, 'Adidas Group');
                populateSelect('debtor', debtorRes.data.value, 'Adidas Malaysia Sdn Bhd');
                populateSelect('agency', agencyRes.data.value, 'Eightbar');
                
                // Show form, hide loader
                dom.campaign.form.classList.remove('hidden');
                dom.campaign.loader.classList.add('hidden');
                
            } catch (error) {
                console.error("Error loading campaign form data:", error);
                // Show error, hide loader
                dom.campaign.formError.classList.remove('hidden');
                dom.campaign.loader.classList.add('hidden');
            }
        }
        
        /**
         * Helper to populate a <select> element.
         * @param {string} elementId - The ID of the <select> element.
         * @param {Array<object>} data - The array of { value: "..." } objects.
         * @param {string} defaultValue - The default value to select.
         */
        function populateSelect(elementId, data, defaultValue) {
            const select = document.getElementById(elementId);
            if (!select) return;
            
            select.innerHTML = ''; // Clear "Loading..."
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.value;
                option.textContent = item.value;
                if (item.value === defaultValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }
        
        /**
         * Handles the submission of the campaign form.
         * @param {Event} event - The form submit event.
         */
        async function handleCampaignSubmit(event) {
            event.preventDefault();
            
            // Show loading state
            dom.campaign.submitButton.disabled = true;
            dom.campaign.submitText.classList.add('hidden');
            dom.campaign.submitSpinner.classList.remove('hidden');
            dom.campaign.resultContainer.classList.add('hidden');

            const form = event.target;
            const formData = new FormData(form);
            const payload = {
                fields: {}
            };

            formData.forEach((value, key) => {
                if (key.startsWith('fields.')) {
                    const fieldName = key.replace('fields.', '');
                    payload.fields[fieldName] = value;
                } else {
                    payload[key] = value;
                }
            });
            
            // --- Post-process specific fields ---
            
            // Parse varientId to int
            payload.varientId = parseInt(payload.varientId, 10);

            // Parse overallbudget to number
            payload.fields.overallbudget = parseFloat(payload.fields.overallbudget);
            
            // Parse selectedchannels into an array
            payload.fields.selectedchannels = payload.fields.selectedchannels
                .split(',')
                .map(s => s.trim())
                .filter(Boolean); // Filter out empty strings
            
            // --- Make API Call ---
            const url = `${config.getXpiBaseUrl()}/api/v1/wrikexpi/campaign`;
            const token = auth.getBearerToken();
            
            if (!token) {
                showCampaignResult({ error: "Authentication token is missing. Please log out and log in again." }, 'error');
                auth.logout(); // Force logout
                return;
            }
            
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': token
            };

            const response = await loggedFetch(url, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(payload)
            });
            
            // --- Show Result ---
            showCampaignResult(response.data, response.ok ? 'success' : 'error');
            
            // --- Reset button state ---
            dom.campaign.submitButton.disabled = false;
            dom.campaign.submitText.classList.remove('hidden');
            dom.campaign.submitSpinner.classList.add('hidden');
        }

        /**
         * Displays the campaign submission result in the <pre> tag.
         * @param {object} data - The response data.
         * @param {'success' | 'error'} type - The type of result.
         */
        function showCampaignResult(data, type) {
            const pre = dom.campaign.resultPre;
            pre.textContent = JSON.stringify(data, null, 2);
            
            if (type === 'success') {
                pre.className = 'bg-gray-800 p-4 rounded-lg text-xs overflow-x-auto text-green-300';
            } else {
                pre.className = 'bg-gray-800 p-4 rounded-lg text-xs overflow-x-auto text-red-300';
            }
            
            dom.campaign.resultContainer.classList.remove('hidden');
            // Scroll to result
            dom.campaign.resultContainer.scrollIntoView({ behavior: 'smooth' });
        }


        // === APP INITIALIZATION ===
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Global Event Listeners ---
            
            // Routing
            window.addEventListener('hashchange', handleRouting);
            
            // Sidebar Toggles
            dom.openSidebarButton.addEventListener('click', () => {
                dom.mobileSidebar.classList.remove('-translate-x-full');
            });
            dom.closeSidebarButton.addEventListener('click', () => {
                dom.mobileSidebar.classList.add('-translate-x-full');
            });

            // Logout
            dom.logoutButton.addEventListener('click', (e) => {
                e.preventDefault();
                auth.logout();
            });
            dom.mobileLogoutButton.addEventListener('click', (e) => {
                e.preventDefault();
                auth.logout();
            });
            
            // Dev Tool
            dom.devToolToggle.addEventListener('click', () => toggleDevTool(true));
            dom.devToolClose.addEventListener('click', () => toggleDevTool(false));
            dom.devToolPurge.addEventListener('click', purgeLogs);
            
            // --- Module-Specific Listeners ---
            
            // Admin
            dom.admin.saveButton.addEventListener('click', saveAdminSettings);
            
            // Login
            dom.login.authButton.addEventListener('click', handleOAuthRedirect);
            dom.login.startOverButton.addEventListener('click', () => {
                window.location.href = window.location.pathname;
            });
            
            // Campaign
            dom.campaign.form.addEventListener('submit', handleCampaignSubmit);

            // --- Define custom element classes for inputs ---
            // This is a common pattern to avoid repeating classes in HTML
            const formInputClasses = 'w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50';
            document.querySelectorAll('.form-input').forEach(el => {
                el.className = `${el.className} ${formInputClasses}`;
            });

            // --- Initial Load ---
            handleRouting(); // Run routing logic on page load
        });
    </script>
</body>
</html>
