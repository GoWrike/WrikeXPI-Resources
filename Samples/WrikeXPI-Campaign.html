<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrike Campaign Submitter</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>

    <style>
        /* Base page styling */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Fix for date picker icon color in dark mode */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
            cursor: pointer;
        }

        /* Custom scrollbar for a more modern feel */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 font-sans">

    <div id="app-container" class="flex min-h-screen">

        <nav id="sidebar" class="bg-gray-800 w-64 p-4 space-y-2 flex-shrink-0 flex-col hidden shadow-lg">
            <div>
                <h2 class="text-xl font-bold text-white px-2 mb-4">Modules</h2>
                <a href="#" id="nav-home" class="block px-4 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                    Home
                </a>
                <a href="#" id="nav-campaign" class="block px-4 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                    Campaign Submission
                </a>
            </div>
            <div class="flex-grow"></div> <div>
                <button id="logout-button" class="w-full text-left px-4 py-2 rounded-md text-gray-300 bg-red-800 hover:bg-red-700 hover:text-white transition-colors">
                    Logout
                </button>
            </div>
        </nav>

        <div class="flex-1 flex flex-col overflow-hidden">
            
            <header id="main-header" class="bg-gray-800 shadow-md p-4 hidden">
                <button id="toggle-sidebar" class="text-gray-300 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </header>

            <main class="flex-1 p-4 md:p-8 overflow-auto">

                <div id="login-module" class="max-w-md mx-auto mt-10 md:mt-20">
                    <div class="bg-gray-800 p-8 rounded-lg shadow-xl border border-gray-700">
                        <h2 class="text-2xl font-bold text-center text-white mb-6">Wrike API Login</h2>
                        
                        <form id="login-form">
                            <div class="mb-4">
                                <label for="username" class="block text-sm font-medium text-gray-300 mb-1">User Name</label>
                                <input type="text" id="username" required
                                       class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div class="mb-6">
                                <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                                <input type="password" id="password" required
                                       class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <button type="submit" id="login-button" 
                                    class="w-full px-4 py-2 font-semibold rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                Login
                            </button>
                        </form>

                        <div id="login-feedback" class="mt-4 text-center text-sm min-h-[1.25rem]"></div>
                    </div>
                </div>

                <div id="home-module" class="max-w-4xl mx-auto hidden">
                    <div class="bg-gray-800 p-8 rounded-lg shadow-xl border border-gray-700 text-center">
                        <h2 class="text-3xl font-bold text-white mb-4">Welcome!</h2>
                        <p class="text-lg text-gray-300 mb-8">Please select a module from the sidebar to begin.</p>
                        <button id="home-nav-campaign" 
                                class="px-6 py-3 font-semibold rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition-colors">
                            Go to Campaign Submission
                        </button>
                    </div>
                </div>


                <div id="campaign-module" class="max-w-4xl mx-auto hidden">
                    <div class="bg-gray-800 p-6 md:p-8 rounded-lg shadow-xl border border-gray-700">
                        <h2 class="text-2xl font-bold text-white mb-6">Create New Campaign</h2>
                        
                        <form id="campaign-form">
                            <input type="hidden" id="type" value="Campaign Request">
                            <input type="hidden" id="space" value="GRM-MYS-GMN">
                            <input type="hidden" id="entity" value="Campaign">
                            <input type="hidden" id="varientId" value="1">

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                
                                <div class="md:col-span-2">
                                    <label for="campaignname" class="block text-sm font-medium text-gray-300 mb-1">Campaign Name</label>
                                    <input type="text" id="campaignname" value="World Pinball Day 7000" required
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="client" class="block text-sm font-medium text-gray-300 mb-1">Client</label>
                                    <input type="text" id="client" value="Adidas Group"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="brand" class="block text-sm font-medium text-gray-300 mb-1">Brand</label>
                                    <input type="text" id="brand" value="World Pinball"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="agency" class="block text-sm font-medium text-gray-300 mb-1">Agency</label>
                                    <input type="text" id="agency" value="Eightbar"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="debtor" class="block text-sm font-medium text-gray-300 mb-1">Debtor</label>
                                    <input type="text" id="debtor" value="Adidas Malaysia Sdn Bhd"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                
                                <hr class="md:col-span-2 border-gray-600 my-2">

                                <div>
                                    <label for="requestedstartdate" class="block text-sm font-medium text-gray-300 mb-1">Requested Start Date</label>
                                    <input type="date" id="requestedstartdate" value="2026-07-01"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="campaignstartdate" class="block text-sm font-medium text-gray-300 mb-1">Campaign Start Date</label>
                                    <input type="date" id="campaignstartdate" value="2026-08-29"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="campaignenddate" class="block text-sm font-medium text-gray-300 mb-1">Campaign End Date</label>
                                    <input type="date" id="campaignenddate" value="2026-10-29"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="campaignobjective" class="block text-sm font-medium text-gray-300 mb-1">Campaign Objective</label>
                                    <input type="text" id="campaignobjective" value="Upper Funnel / Awareness"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <hr class="md:col-span-2 border-gray-600 my-2">

                                <div>
                                    <label for="overallbudget" class="block text-sm font-medium text-gray-300 mb-1">Overall Budget</label>
                                    <input type="number" id="overallbudget" value="100" step="0.01"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="currency" class="block text-sm font-medium text-gray-300 mb-1">Currency</label>
                                    <input type="text" id="currency" value="SGD"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                
                                <div>
                                    <label for="pod" class="block text-sm font-medium text-gray-300 mb-1">Pod</label>
                                    <input type="text" id="pod" value="Pod 1A"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                
                                <div>
                                    <label for="requestormarket" class="block text-sm font-medium text-gray-300 mb-1">Requestor Market</label>
                                    <input type="text" id="requestormarket" value="Singapore"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>

                                <div>
                                    <label for="optin" class="block text-sm font-medium text-gray-300 mb-1">Opt-in</label>
                                    <select id="optin"
                                            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="No" selected>No</option>
                                        <option value="Yes">Yes</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="porequired" class="block text-sm font-medium text-gray-300 mb-1">PO Required</label>
                                    <select id="porequired"
                                            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="No" selected>No</option>
                                        <option value="Yes">Yes</option>
                                    </select>
                                </div>

                                <div class="md:col-span-2">
                                    <label for="selectedchannels" class="block text-sm font-medium text-gray-300 mb-1">Selected Channels (comma-separated)</label>
                                    <input type="text" id="selectedchannels" value="Twitter"
                                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="e.g., Twitter, Facebook, Google">
                                </div>

                            </div> <div class="mt-8 text-right">
                                <button type="submit" id="submit-campaign"
                                        class="px-6 py-2 font-semibold rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                    Submit Campaign
                                </button>
                            </div>
                        </form>

                        <div id="form-result" class="mt-6 hidden">
                            <h3 class="text-lg font-semibold mb-2 text-white">Submission Result:</h3>
                            <pre id="result-content" class="bg-gray-900 p-4 rounded-md overflow-x-auto text-sm whitespace-pre-wrap break-all"></pre>
                        </div>

                    </div>
                </div>

            </main>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Element Selection ---
            const loginModule = document.getElementById('login-module');
            const homeModule = document.getElementById('home-module');
            const campaignModule = document.getElementById('campaign-module');
            const allModules = [loginModule, homeModule, campaignModule];

            const sidebar = document.getElementById('sidebar');
            const mainHeader = document.getElementById('main-header');
            const toggleSidebarButton = document.getElementById('toggle-sidebar');
            
            // Navigation
            const navHome = document.getElementById('nav-home');
            const navCampaign = document.getElementById('nav-campaign');
            const homeNavCampaign = document.getElementById('home-nav-campaign');
            const logoutButton = document.getElementById('logout-button');

            // Login Form
            const loginForm = document.getElementById('login-form');
            const loginButton = document.getElementById('login-button');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginFeedback = document.getElementById('login-feedback');

            // Campaign Form
            const campaignForm = document.getElementById('campaign-form');
            const submitCampaignButton = document.getElementById('submit-campaign');
            const formResult = document.getElementById('form-result');
            const resultContent = document.getElementById('result-content');


            // --- Cookie Helper Functions ---
            // NOTE: Storing passwords in cookies is insecure (vulnerable to XSS).
            // This is implemented *only* to match the prompt's explicit requirement.
            // A production app should use an HTTP-only session token.
            function setCookie(name, value, days) {
                let expires = "";
                if (days) {
                    const date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax; Secure";
            }

            function getCookie(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            function deleteCookie(name) {
                document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            }


            // --- Authentication & State Functions ---
            function isAuthenticated() {
                return getCookie('username') && getCookie('password');
            }

            function getAuthHeader() {
                const user = getCookie('username');
                const pass = getCookie('password');
                if (user && pass) {
                    return 'Basic ' + btoa(user + ':' + pass);
                }
                return null;
            }

            function showModule(moduleId) {
                // Hide all modules
                allModules.forEach(module => module.classList.add('hidden'));
                
                // Show the target module
                const targetModule = document.getElementById(moduleId);
                if (targetModule) {
                    targetModule.classList.remove('hidden');
                }

                // Toggle main UI elements based on auth state
                if (moduleId === 'login-module') {
                    sidebar.classList.add('hidden');
                    sidebar.classList.remove('flex');
                    mainHeader.classList.add('hidden');
                } else {
                    sidebar.classList.remove('hidden');
                    sidebar.classList.add('flex'); // Make it flex column
                    mainHeader.classList.remove('hidden');
                }
            }


            // --- Event Listener: Login Form ---
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                loginButton.disabled = true;
                loginButton.textContent = 'Logging in...';
                loginFeedback.textContent = '';
                loginFeedback.className = 'mt-4 text-center text-sm min-h-[1.25rem]'; // Reset classes
                
                const username = usernameInput.value;
                const password = passwordInput.value;
                const basicAuth = 'Basic ' + btoa(username + ':' + password);
                const loginUrl = 'https://api.wrikexpi.groupm.com/api/v1/wrikexpi/amoeba/wrikeapi/contacts?me';

                try {
                    const response = await fetch(loginUrl, {
                        method: 'GET',
                        headers: {
                            'Authorization': basicAuth
                        }
                    });

                    const data = await response.json();

                    if (response.ok && data.success === true && data.data.length > 0) {
                        // SUCCESS
                        const user = data.data[0];
                        loginFeedback.textContent = `${user.firstName} ${user.lastName} login successfully.`;
                        loginFeedback.classList.add('text-green-400');
                        
                        setCookie('username', username, 7);
                        setCookie('password', password, 7);

                        // Redirect to home module after a short delay
                        setTimeout(() => {
                            showModule('home-module');
                            loginForm.reset();
                            loginFeedback.textContent = '';
                        }, 1500);

                    } else {
                        // FAIL (API error or wrong credentials)
                        loginFeedback.textContent = 'Login failed, please try again.';
                        loginFeedback.classList.add('text-red-400');
                    }

                } catch (error) {
                    // FAIL (Network error)
                    console.error('Login Error:', error);
                    loginFeedback.textContent = 'Login failed. Check console for details.';
                    loginFeedback.classList.add('text-red-400');
                } finally {
                    // Re-enable button unless we are redirecting
                    if (!isAuthenticated()) {
                        loginButton.disabled = false;
                        loginButton.textContent = 'Login';
                    }
                }
            });


            // --- Event Listener: Campaign Form ---
            campaignForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Check auth before submitting
                if (!isAuthenticated()) {
                    alert('You are not logged in. Redirecting to login.');
                    showModule('login-module');
                    return;
                }

                submitCampaignButton.disabled = true;
                submitCampaignButton.textContent = 'Submitting...';
                formResult.classList.add('hidden');
                resultContent.className = 'bg-gray-900 p-4 rounded-md overflow-x-auto text-sm whitespace-pre-wrap break-all'; // Reset classes

                // 1. Parse 'selectedchannels' from text input into an array
                const channelsValue = document.getElementById('selectedchannels').value;
                const channelsArray = channelsValue
                    .split(',')                  // Split by comma
                    .map(ch => ch.trim())        // Trim whitespace
                    .filter(ch => ch.length > 0); // Remove empty strings

                // 2. Construct the payload
                const payload = {
                    type: document.getElementById('type').value,
                    space: document.getElementById('space').value,
                    entity: document.getElementById('entity').value,
                    varientId: parseInt(document.getElementById('varientId').value, 10),
                    fields: {
                        requestedstartdate: document.getElementById('requestedstartdate').value,
                        agency: document.getElementById('agency').value,
                        brand: document.getElementById('brand').value,
                        client: document.getElementById('client').value,
                        debtor: document.getElementById('debtor').value,
                        currency: document.getElementById('currency').value,
                        pod: document.getElementById('pod').value,
                        campaignname: document.getElementById('campaignname').value,
                        campaignstartdate: document.getElementById('campaignstartdate').value,
                        campaignenddate: document.getElementById('campaignenddate').value,
                        campaignobjective: document.getElementById('campaignobjective').value,
                        requestormarket: document.getElementById('requestormarket').value,
                        optin: document.getElementById('optin').value,
                        porequired: document.getElementById('porequired').value,
                        overallbudget: document.getElementById('overallbudget').value, // API will parse string to number
                        selectedchannels: channelsArray
                    }
                };
                
                const campaignUrl = 'https://api.wrikexpi.groupm.com/api/v1/wrikexpi/campaign';

                try {
                    const response = await fetch(campaignUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': getAuthHeader() // Use Basic Auth from cookies
                        },
                        body: JSON.stringify(payload)
                    });

                    // Try to get response text/json regardless of status
                    let responseData;
                    try {
                        responseData = await response.json();
                    } catch (jsonError) {
                        // If response is not JSON (e.g., 502 error page)
                        responseData = await response.text();
                    }

                    const responseOutput = (typeof responseData === 'object') 
                        ? JSON.stringify(responseData, null, 2) 
                        : responseData;


                    if (response.ok) {
                        // SUCCESS (2xx status)
                        resultContent.textContent = responseOutput;
                        resultContent.classList.add('text-green-400');
                    } else {
                        // FAIL (4xx, 5xx status)
                        resultContent.textContent = `Error: ${response.status} ${response.statusText}\n\n${responseOutput}`;
                        resultContent.classList.add('text-red-400');
                    }

                } catch (error) {
                    // FAIL (Network error, CORS, etc.)
                    console.error('Submission Error:', error);
                    resultContent.textContent = `Network Error: ${error.message}\n\nSomething went wrong, please check the console and try again.`;
                    resultContent.classList.add('text-red-400');
                } finally {
                    // Re-enable button and show result
                    submitCampaignButton.disabled = false;
                    submitCampaignButton.textContent = 'Submit Campaign';
                    formResult.classList.remove('hidden');
                    // Scroll to the result
                    formResult.scrollIntoView({ behavior: 'smooth' });
                }
            });


            // --- Navigation Event Listeners ---
            navHome.addEventListener('click', (e) => {
                e.preventDefault();
                if (isAuthenticated()) showModule('home-module');
            });

            navCampaign.addEventListener('click', (e) => {
                e.preventDefault();
                if (isAuthenticated()) showModule('campaign-module');
            });

            homeNavCampaign.addEventListener('click', (e) => {
                e.preventDefault();
                if (isAuthenticated()) showModule('campaign-module');
            });

            logoutButton.addEventListener('click', () => {
                deleteCookie('username');
                deleteCookie('password');
                showModule('login-module');
            });

            toggleSidebarButton.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('flex');
            });


            // --- App Initialization ---
            function checkInitialAuth() {
                if (isAuthenticated()) {
                    showModule('home-module');
                } else {
                    showModule('login-module');
                }
            }
            
            checkInitialAuth();

        });
    </script>

</body>
</html>
